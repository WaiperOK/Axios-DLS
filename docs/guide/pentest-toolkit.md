# Building a Pentest Toolkit Module

This guide demonstrates how to package reusable Axios constructs for repeatable offensive security engagements. The goal is to create a module that inventories a target scope, executes reconnaissance, enriches findings, and generates a comprehensive report.

## Module Layout

Create the directory structure:

```
mkdir -p modules/pentest
cat <<'EOF' > modules/pentest/toolkit.ax
# Pentest toolkit module

let scope_name = "${scope_name}"
let cidr_range = "${cidr_range}"
let web_host = "${web_host}"
let wordlist = "${wordlist}"

asset_group ${scope_name} {
  scope assessment
  cidr ${cidr_range}
  primary_web ${web_host}
}

scan discovery nmap {
  flags -sS -sV -Pn --host-timeout 30s
  target ${cidr_range}
} -> ${scope_name}_discovery

script enumerate_directories {
  run gobuster
  args dir -u ${web_host} -w ${wordlist} -t 25 -q
} -> ${scope_name}_directories

report stdout {
  include ${scope_name}_discovery
  include ${scope_name}_directories
}
EOF
```

- The module expects four variables to be provided by the importing scenario: `scope_name`, `cidr_range`, `web_host`, and `wordlist`.
- Variables are interpolated throughout the module to avoid duplicating configuration.

## Importing the Module

Create a scenario that supplies the required variables and imports the module:

```
cat <<'EOF' > engagements/lab.ax
let scope_name = "lab"
let cidr_range = "10.1.0.0/24"
let web_host = "http://10.1.0.42"
let wordlist = "wordlists/sec_lists/common.txt"

import ../modules/pentest/toolkit.ax
EOF
```

Execute the scenario:

```
cargo run -p axion-cli -- run engagements/lab.ax --json --var cidr_range=10.2.0.0/24
```

The `--var` flag permits scenario specialisation without modifying source files; repeat it to supply multiple overrides. For direct execution through the Python runner the same flag is accepted (`python tools/axion_runner.py run ... --var key=value`).

- Ensure that requisite binaries (`nmap`, `gobuster`) and wordlists are available on the execution host.
- The report artifact, together with raw scan results and script output, will be stored under `artifacts/`.

## Extending the Toolkit

1. **Credential checks**: Add `script` directives that validate default passwords or API keys when credentials are provided securely.
2. **Service-specific scanners**: Branch the scenario based on detected ports (e.g., run `nikto` when HTTPS is identified). This can be achieved by writing enrichment scripts that parse existing artifacts and emit additional plan directives (future roadmap).
3. **Reporting backends**: Introduce `report sarif` or `report html` as soon as the runtime supports alternative targets, enabling integration with vulnerability management platforms.

## Operational Considerations

- **Safety**: Adjust `nmap` flags to respect engagement rules of engagement (timing, stealth).
- **Source control**: Store modules under version control with peer review to maintain provenance.
- **Parameter validation**: Future versions of Axios will allow schema declarations for module variables; until then, document expectations (format, units, secrets) in accompanying README files.

By encapsulating methodology in modules, teams can standardise engagements, iterate on techniques collaboratively, and maintain a library of vetted procedures.
